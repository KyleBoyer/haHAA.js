"use strict";!function(t){function e(){return Promise.all([new Promise(n),new Promise(a)])}function n(e,n){t.get("https://twitchemotes.com/api_cache/v2/global.json",function(t){e(t)})}function a(e,n){t.get("https://api.betterttv.net/2/emotes/",function(t,n){e(t)})}function i(){console.log("Could not get emote list, you will only have Kappas Kappa"),window.KappaJS={timestamp:0,twitch:{meta:{generated_at:"2016-09-10T19:40:04Z"},template:{small:"https://static-cdn.jtvnw.net/emoticons/v1/{image_id}/1.0",medium:"https://static-cdn.jtvnw.net/emoticons/v1/{image_id}/2.0",large:"https://static-cdn.jtvnw.net/emoticons/v1/{image_id}/3.0"},emotes:{Kappa:{description:"This is the face of Josh, a former Justin.tv employee. Kappa is generally used to indicate sarcasm or trolling.",image_id:25,first_seen:null}}},bttv:{emotes:{}}},r=new RegExp("\\b("+Object.keys(KappaJS.twitch.emotes).join("|")+")\\b","g")}function o(t){return new RegExp("\\b("+Object.keys(t.emotes).join("|")+")\\b","g")}function p(t){return new RegExp("\\b("+Object.keys(t.emotes).map(function(t){return t.replace(/([(\')])/g,"\\$1")}).join("|")+")\\b","g")}function s(t){var e={urlTemplate:t.urlTemplate,emotes:{}};return t.emotes.forEach(function(t){e.emotes[t.code]=t}),e}function c(){e().then(function(t){window.KappaJS={timestamp:(new Date).getTime()},window.KappaJS.twitch=t[0],window.KappaJS.bttv=s(t[1]),localStorage.setItem("hahaa-js",JSON.stringify(window.KappaJS)),r=o(window.KappaJS.twitch),u=p(window.KappaJS.bttv)},i)}function m(){var t=l.indexOf('"timestamp":')+'"timestamp":'.length,e=l.indexOf(",",t),n=parseInt(l.substring(t,e));return(new Date).getTime()-n>w}var l=localStorage.getItem("hahaa-js"),r=/\\b(Kappa)\\b/g,u=/\\b(haHAA|LUL)\\b/g,w=2592e5;null!==l?m()?(console.log("Rebuilding Emote data cache"),c()):(window.KappaJS=JSON.parse(l),r=o(window.KappaJS.twitch),u=p(window.KappaJS.bttv)):c(),t.fn.kappa=function(e){function n(t,e){var n=t.image_id;return['<img src="',KappaJS.twitch.template[s.emoteSize].replace("{image_id}",n),'" ',null===s.customClass?"":'class="'+s.customClass+'" ','alt="',e,'">'].join("")}function a(t){var e=t.id,n=t.code;return'<img src="https:'+KappaJS.bttv.urlTemplate.replace("{{id}}/{{image}}",e+'/1x"')+' alt="'+n+'">'}function i(){var t=setInterval(function(){"undefined"!=typeof window.KappaJS&&(o(),clearInterval(t))},500)}function o(){t(p).each(function(e,i){t(i).html(t(i).html().replace(r,function(t,e){return n(KappaJS.twitch.emotes[e],e)})),t(i).html(t(i).html().replace(u,function(t,e){return a(KappaJS.bttv.emotes[e],e)}))})}var p=this,s=t.extend({customClass:null,emoteSize:"small"},e);"undefined"==typeof window.KappaJS?i():o()}}(jQuery);